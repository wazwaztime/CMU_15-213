```
0000000000401204 <fun7>:
  401204:	48 83 ec 08          	sub    $0x8,%rsp
  401208:	48 85 ff             	test   %rdi,%rdi #rdi = 0 : null node : return -1
  40120b:	74 2b                	je     401238 <fun7+0x34>
  40120d:	8b 17                	mov    (%rdi),%edx #edx=mem[rdi](val) struct node { size_t val; node *son[2] };
  40120f:	39 f2                	cmp    %esi,%edx # edx <= esi
  401211:	7e 0d                	jle    401220 <fun7+0x1c> # goto flag2
  401213:	48 8b 7f 08          	mov    0x8(%rdi),%rdi # rdi = mem[rdi+1] (son[0])
  401217:	e8 e8 ff ff ff       	call   401204 <fun7>
  40121c:	01 c0                	add    %eax,%eax # eax += eax
  40121e:	eb 1d                	jmp    40123d <fun7+0x39> # return
  401220:	b8 00 00 00 00       	mov    $0x0,%eax #flag2 eax=0
  401225:	39 f2                	cmp    %esi,%edx #esi==edx
  401227:	74 14                	je     40123d <fun7+0x39> #return 0
  401229:	48 8b 7f 10          	mov    0x10(%rdi),%rdi #rdi = mem[rdi+2] (son[1])
  40122d:	e8 d2 ff ff ff       	call   401204 <fun7> #fun7(rdi)
  401232:	8d 44 00 01          	lea    0x1(%rax,%rax,1),%eax #eax=eax+eax+1
  401236:	eb 05                	jmp    40123d <fun7+0x39> #return
  401238:	b8 ff ff ff ff       	mov    $0xffffffff,%eax #eax=-1
  40123d:	48 83 c4 08          	add    $0x8,%rsp
  401241:	c3                   	ret    
 
#äºŒå‰æŸ¥æ‰¾æ ‘

0000000000401242 <secret_phase>:
  401242:	53                   	push   %rbx
  401243:	e8 56 02 00 00       	call   40149e <read_line>
  401248:	ba 0a 00 00 00       	mov    $0xa,%edx
  40124d:	be 00 00 00 00       	mov    $0x0,%esi
  401252:	48 89 c7             	mov    %rax,%rdi
  401255:	e8 76 f9 ff ff       	call   400bd0 <strtol@plt>
  40125a:	48 89 c3             	mov    %rax,%rbx
  40125d:	8d 40 ff             	lea    -0x1(%rax),%eax
  401260:	3d e8 03 00 00       	cmp    $0x3e8,%eax #ebx-1 <= 1000 go
  401265:	76 05                	jbe    40126c <secret_phase+0x2a> 
  401267:	e8 ce 01 00 00       	call   40143a <explode_bomb>
  40126c:	89 de                	mov    %ebx,%esi
  40126e:	bf f0 30 60 00       	mov    $0x6030f0,%edi # edi=0x6030f0 root
  401273:	e8 8c ff ff ff       	call   401204 <fun7> #return = 2 å…ˆå·¦å­æ ‘ç„¶åå³å­æ ‘
  401278:	83 f8 02             	cmp    $0x2,%eax
  40127b:	74 05                	je     401282 <secret_phase+0x40>
  40127d:	e8 b8 01 00 00       	call   40143a <explode_bomb>
  401282:	bf 38 24 40 00       	mov    $0x402438,%edi
  401287:	e8 84 f8 ff ff       	call   400b10 <puts@plt>
  40128c:	e8 33 03 00 00       	call   4015c4 <phase_defused>
  401291:	5b                   	pop    %rbx
  401292:	c3                   	ret    
  401293:	90                   	nop
  401294:	90                   	nop
  401295:	90                   	nop
  401296:	90                   	nop
  401297:	90                   	nop
  401298:	90                   	nop
  401299:	90                   	nop
  40129a:	90                   	nop
  40129b:	90                   	nop
  40129c:	90                   	nop
  40129d:	90                   	nop
  40129e:	90                   	nop
  40129f:	90                   	nop

```



(gdb) x/b 0x6030f0
0x6030f0 <n1>:  "$"
(gdb) x/b 0x6030f1
0x6030f1 <n1+1>:        ""
(gdb) x/b 0x6030f2
0x6030f2 <n1+2>:        ""
(gdb) x/b 0x6030f0
0x6030f0 <n1>:  "$"
(gdb) x/ 0x6030f0
0x6030f0 <n1>:  "$"
(gdb) x/w 0x6030f0
0x6030f0 <n1>:  U"$"
(gdb) p/d 0x6030f0
$1 = 6303984
(gdb) x/g 0x6030f8
0x6030f8 <n1+8>:        6304016
(gdb) x/g 6304016
0x603110 <n21>: 8
(gdb) x/b 6304016
0x603110 <n21>: 8
(gdb) x/g 6304032
0x603120 <n21+16>:      6304080
(gdb) x/b 6304080
0x603150 <n32>: 22
(gdb) x/g 6304080
0x603150 <n32>: 22
(gdb) 



è§£å†³äº†ã€‚



deepseekçš„å›ç­”ï¼š

æ ¹æ®æä¾›çš„æ±‡ç¼–ä»£ç å’ŒäºŒå‰æ ‘ç»“æ„åˆ†æï¼Œ`secret_phase`è¦æ±‚è¾“å…¥ä¸€ä¸ªæ•´æ•°ï¼Œè¯¥æ•´æ•°å‡1åå¿…é¡»å°äºæˆ–ç­‰äº1000ï¼ˆå³è¾“å…¥èŒƒå›´åœ¨1åˆ°1001ä¹‹é—´ï¼‰ã€‚éšåï¼Œå®ƒè°ƒç”¨`fun7`å‡½æ•°ï¼Œä¼ å…¥äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹åœ°å€`0x6030f0`å’Œè¾“å…¥å€¼ï¼Œè¦æ±‚`fun7`è¿”å›2ã€‚

### äºŒå‰æ ‘ç»“æ„ï¼ˆèŠ‚ç‚¹å€¼å‡ä¸ºåè¿›åˆ¶ï¼‰ï¼š
- æ ¹èŠ‚ç‚¹ï¼ˆn1, 0x6030f0ï¼‰ï¼šå€¼=36
  - å·¦å­èŠ‚ç‚¹ï¼ˆn21, 0x603110ï¼‰ï¼šå€¼=8
    - å·¦å­èŠ‚ç‚¹ï¼ˆn31, 0x603190ï¼‰ï¼šå€¼=6
      - å·¦å­èŠ‚ç‚¹ï¼ˆn41, 0x6031d0ï¼‰ï¼šå€¼=1
      - å³å­èŠ‚ç‚¹ï¼ˆn42, 0x6031b0ï¼‰ï¼šå€¼=7
    - å³å­èŠ‚ç‚¹ï¼ˆn32, 0x603150ï¼‰ï¼šå€¼=22
      - å·¦å­èŠ‚ç‚¹ï¼ˆn43, 0x603270ï¼‰ï¼šå€¼=20
      - å³å­èŠ‚ç‚¹ï¼ˆn44, 0x603230ï¼‰ï¼šå€¼=35
  - å³å­èŠ‚ç‚¹ï¼ˆn22, 0x603130ï¼‰ï¼šå€¼=107
    - å·¦å­èŠ‚ç‚¹ï¼ˆn33, 0x603170ï¼‰ï¼šå€¼=45
      - å·¦å­èŠ‚ç‚¹ï¼ˆn45, 0x603250ï¼‰ï¼šå€¼=32
      - å³å­èŠ‚ç‚¹ï¼ˆn46, 0x603210ï¼‰ï¼šå€¼=137
    - å³å­èŠ‚ç‚¹ï¼ˆn34, 0x6030d0ï¼‰ï¼šå€¼=655
      - å·¦å­èŠ‚ç‚¹ï¼ˆn47, 0x6031f0ï¼‰ï¼šå€¼=122
      - å³å­èŠ‚ç‚¹ï¼ˆn48, 0x603290ï¼‰ï¼šå€¼=691

### `fun7`å‡½æ•°é€»è¾‘ï¼ˆä¼ªä»£ç ï¼‰ï¼š
```c
int fun7(node* rdi, int esi) {
    if (rdi == NULL) return -1;
    int edx = rdi->val;
    if (edx <= esi) {
        if (edx == esi) return 0;
        else { // edx < esi
            node* right = rdi->right;
            int rax = fun7(right, esi);
            return 2 * rax + 1;
        }
    } else { // edx > esi
        node* left = rdi->left;
        int rax = fun7(left, esi);
        return 2 * rax;
    }
}
```

### æ±‚è§£è¿”å›å€¼ä¸º2çš„è¾“å…¥ï¼š
éœ€è¦æ‰¾åˆ°ä¸€ä¸ªè¾“å…¥å€¼`x`ï¼ˆ1 â‰¤ x â‰¤ 1001ï¼‰ï¼Œä½¿å¾—`fun7`è¿”å›2ã€‚åˆ†æé€’å½’è·¯å¾„ï¼š
- æœ€ç»ˆè¿”å›2å¿…é¡»ç”±`2 * rax`äº§ç”Ÿï¼ˆå³æœ€åä¸€æ­¥èµ°å·¦å­æ ‘åˆ†æ”¯ï¼‰ï¼Œä¸”`rax`å¿…é¡»ä¸º1ã€‚
- `rax=1`å¿…é¡»ç”±`2 * rax + 1`äº§ç”Ÿï¼ˆå³ä¸Šä¸€æ­¥èµ°å³å­æ ‘åˆ†æ”¯ï¼‰ï¼Œä¸”`rax`å¿…é¡»ä¸º0ã€‚
- `rax=0`ä»…åœ¨å½“å‰èŠ‚ç‚¹å€¼ç­‰äºè¾“å…¥å€¼æ—¶å‘ç”Ÿã€‚

å› æ­¤ï¼Œæœ‰æ•ˆè·¯å¾„ä¸ºï¼š
1. æ ¹èŠ‚ç‚¹ï¼ˆ36ï¼‰å¤§äº`x`ï¼Œèµ°å·¦å­æ ‘ï¼ˆèŠ‚ç‚¹8ï¼‰ï¼Œè¿”å›`2 * fun7(8, x)`ã€‚
2. èŠ‚ç‚¹8å°äº`x`ï¼Œèµ°å³å­æ ‘ï¼ˆèŠ‚ç‚¹22ï¼‰ï¼Œè¿”å›`2 * fun7(22, x) + 1`ã€‚
3. èŠ‚ç‚¹22çš„å¤„ç†ï¼š
   - è‹¥`x=22`ï¼šèŠ‚ç‚¹å€¼ç­‰äºè¾“å…¥ï¼Œè¿”å›0 â†’ èŠ‚ç‚¹8è¿”å›`2*0 + 1 = 1` â†’ æ ¹èŠ‚ç‚¹è¿”å›`2*1 = 2`ï¼ˆç¬¦åˆï¼‰ã€‚
   - è‹¥`x=20`ï¼šèŠ‚ç‚¹22å¤§äº20ï¼Œèµ°å·¦å­æ ‘ï¼ˆèŠ‚ç‚¹20ï¼‰â†’ èŠ‚ç‚¹20ç­‰äºè¾“å…¥ï¼Œè¿”å›0 â†’ èŠ‚ç‚¹22è¿”å›`2*0 = 0` â†’ èŠ‚ç‚¹8è¿”å›`2*0 + 1 = 1` â†’ æ ¹èŠ‚ç‚¹è¿”å›`2*1 = 2`ï¼ˆä¹Ÿç¬¦åˆï¼‰ã€‚

### éªŒè¯ï¼š
- **è¾“å…¥22**ï¼š
  - `fun7(36,22)`ï¼š36>22 â†’ å·¦å­æ ‘`fun7(8,22)`ã€‚
  - `fun7(8,22)`ï¼š8<22 â†’ å³å­æ ‘`fun7(22,22)`ã€‚
  - `fun7(22,22)`ï¼š22=22 â†’ è¿”å›0ã€‚
  - å›æº¯ï¼š`fun7(8,22)` = 2*0 + 1 = 1ã€‚
  - å›æº¯ï¼š`fun7(36,22)` = 2*1 = 2ï¼ˆæˆåŠŸï¼‰ã€‚
- **è¾“å…¥20**ï¼š
  - `fun7(36,20)`ï¼š36>20 â†’ å·¦å­æ ‘`fun7(8,20)`ã€‚
  - `fun7(8,20)`ï¼š8<20 â†’ å³å­æ ‘`fun7(22,20)`ã€‚
  - `fun7(22,20)`ï¼š22>20 â†’ å·¦å­æ ‘`fun7(20,20)`ã€‚
  - `fun7(20,20)`ï¼š20=20 â†’ è¿”å›0ã€‚
  - å›æº¯ï¼š`fun7(22,20)` = 2*0 = 0ã€‚
  - å›æº¯ï¼š`fun7(8,20)` = 2*0 + 1 = 1ã€‚
  - å›æº¯ï¼š`fun7(36,20)` = 2*1 = 2ï¼ˆæˆåŠŸï¼‰ã€‚

### å…¶ä»–å€¼æ— æ•ˆï¼š
- å¦‚`x=7`ï¼šæœ€ç»ˆè¿”å›4ï¼ˆâ‰ 2ï¼‰ã€‚
- `x=35`ï¼šæœ€ç»ˆè¿”å›6ï¼ˆâ‰ 2ï¼‰ã€‚
- `x=655`ï¼šæœ€ç»ˆè¿”å›3ï¼ˆâ‰ 2ï¼‰ã€‚

### ç»“è®ºï¼š
è¾“å…¥**22**æˆ–**20**å‡å¯é€šè¿‡`secret_phase`ï¼Œä½†22çš„è·¯å¾„æ›´çŸ­ï¼ˆå°‘ä¸€å±‚é€’å½’ï¼‰ã€‚æ¨èè¾“å…¥**22**ä½œä¸ºç­”æ¡ˆã€‚

```plaintext
22
```

Curses, you've found the secret phase!
But finding it and solving it are quite different...

Breakpoint 1, 0x0000000000401242 in secret_phase ()
(gdb) p $eax
$1 = 0
(gdb) c
Continuing.

Breakpoint 2, 0x000000000040143a in explode_bomb ()
(gdb) p $eax
$2 = -8
(gdb) x/2x 0x6030f0
0x6030f0 <n1>:  0x00000024      0x00000000
(gdb) x/4x 0x6030f0
0x6030f0 <n1>:  0x00000024      0x00000000      0x00603110      0x00000000
(gdb) x/4x 0x6030f8
0x6030f8 <n1+8>:        0x00603110      0x00000000      0x00603130      0x00000000
(gdb) x/6x 0x603110
0x603110 <n21>: 0x00000008      0x00000000      0x00603190      0x00000000
0x603120 <n21+16>:      0x00603150      0x00000000
(gdb) x/6x 0x00603150
0x603150 <n32>: 0x00000016      0x00000000      0x00603270      0x00000000
0x603160 <n32+16>:      0x00603230      0x00000000
(gdb) x/6x 0x00603270
0x603270 <n43>: 0x00000014      0x00000000      0x00000000      0x00000000
0x603280 <n43+16>:      0x00000000      0x00000000

åé¢å‘ç°åŸæ¥readlineå†™å¾—å¤ªçƒ‚ï¼Œè¾“å…¥è¡Œæœ«å¿…é¡»è¦æœ‰æ¢è¡Œï¼Œä¸ç„¶ä¼šè¢«åğŸ˜“